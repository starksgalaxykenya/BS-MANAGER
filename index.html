<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProManage | Complete Business Management System</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- html2pdf -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <!-- EmailJS for sending emails -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <!-- QuaggaJS for barcode scanning -->
    <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
    
    <!-- i18next for internationalization -->
    <script src="https://cdn.jsdelivr.net/npm/i18next@22.0.0/dist/umd/i18next.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/i18next-browser-languagedetector@7.0.1/dist/umd/i18nextBrowserLanguageDetector.min.js"></script>
    
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --warning: #f72585;
            --dark: #2b2d42;
            --light: #f8f9fa;
        }
        
        .sidebar {
            transition: transform 0.3s ease;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                position: fixed;
                height: 100vh;
                z-index: 50;
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .overlay.active {
                display: block;
            }
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s ease;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary);
        }
        
        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .badge-success {
            background-color: #10b981;
            color: white;
        }
        
        .badge-warning {
            background-color: #f59e0b;
            color: white;
        }
        
        .badge-danger {
            background-color: #ef4444;
            color: white;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .receipt {
            background-color: white;
            padding: 1.5rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            max-width: 400px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th, .data-table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .data-table th {
            background-color: #f9fafb;
            font-weight: 600;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
        
        .status-active {
            background-color: #10b981;
        }
        
        .status-inactive {
            background-color: #ef4444;
        }
        
        .print-only {
            display: none;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            .print-only {
                display: block !important;
            }
        }
        
        /* Barcode scanner styles */
        #barcode-scanner {
            width: 100%;
            height: 300px;
            background: black;
            position: relative;
        }
        
        #barcode-scanner video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .scanner-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .scanner-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background: red;
            top: 50%;
            animation: scan 2s infinite linear;
        }
        
        @keyframes scan {
            0%, 100% { top: 10%; }
            50% { top: 90%; }
        }
        
        /* Role management styles */
        .role-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .role-admin {
            background-color: #ef4444;
            color: white;
        }
        
        .role-manager {
            background-color: #f59e0b;
            color: white;
        }
        
        .role-staff {
            background-color: #3b82f6;
            color: white;
        }
        
        /* API integration styles */
        .api-status {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .api-connected {
            background-color: #10b981;
        }
        
        .api-disconnected {
            background-color: #ef4444;
        }
        
        .api-pending {
            background-color: #f59e0b;
        }
        
        /* Mobile app styles */
        .pwa-install-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            display: none;
        }
        
        .pwa-install-button:hover {
            background: var(--secondary);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- PWA Install Button -->
    <div id="pwaInstallButton" class="pwa-install-button">
        <i class="fas fa-download mr-2"></i> Install App
    </div>
    
    <!-- Firebase Configuration -->
    <script>
        // Initialize Firebase with your configuration
     // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBORBswvSauHGag4Zkp4f_If3Rx9zNiagU",
  authDomain: "carskenyaapp.firebaseapp.com",
  projectId: "carskenyaapp",
  storageBucket: "carskenyaapp.firebasestorage.app",
  messagingSenderId: "80734328",
  appId: "1:80734328:web:2b4fbe06dabb73dad7258d",
  measurementId: "G-8YYTLJVJK7"
};
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        
        // Initialize services
        const db = firebase.firestore();
        const auth = firebase.auth();
        const storage = firebase.storage();
        
        // Initialize EmailJS
        emailjs.init("YOUR_EMAILJS_PUBLIC_KEY");
        
        // Application state
        const appState = {
            currentUser: null,
            currentTab: 'dashboard',
            cart: [],
            currentSale: null,
            filters: {
                products: {
                    search: '',
                    category: '',
                    status: ''
                }
            },
            userRole: 'admin', // Default role, will be loaded from Firestore
            language: 'en',
            apiConnections: {},
            deferredPrompt: null,
            isPWAInstalled: false
        };
    </script>
    
    <!-- Overlay for mobile -->
    <div class="overlay fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>
    
    <!-- Main container -->
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <div class="sidebar w-64 bg-gray-900 text-white flex flex-col z-50">
            <!-- Logo -->
            <div class="p-6 border-b border-gray-800">
                <h1 class="text-2xl font-bold"><i class="fas fa-cube mr-2"></i>ProManage</h1>
                <p class="text-gray-400 text-sm mt-1" id="userEmail">Loading...</p>
                <div class="mt-2 flex items-center">
                    <span class="role-badge role-admin mr-2" id="userRoleBadge">Admin</span>
                    <span class="text-xs bg-indigo-500 px-2 py-1 rounded" id="userLanguage">EN</span>
                </div>
            </div>
            
            <!-- Navigation -->
            <nav class="flex-1 p-4">
                <ul class="space-y-2" id="sidebarMenu">
                    <!-- Navigation items will be dynamically loaded based on role -->
                </ul>
                
                <!-- System Status -->
                <div class="mt-8 p-4 bg-gray-800 rounded-lg">
                    <h3 class="font-medium mb-2">System Status</h3>
                    <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full bg-green-500 mr-2"></div>
                        <span class="text-sm" id="systemStatus">Connecting...</span>
                    </div>
                    <div class="mt-2 space-y-1" id="apiStatus">
                        <!-- API connection status will be loaded here -->
                    </div>
                </div>
            </nav>
            
            <!-- User Profile -->
            <div class="p-4 border-t border-gray-800">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center">
                            <span class="font-bold" id="userInitials">?</span>
                        </div>
                        <div class="ml-3">
                            <p class="font-medium" id="userName">Loading...</p>
                            <p class="text-sm text-gray-400">Business Owner</p>
                        </div>
                    </div>
                    <button id="logoutBtn" class="text-gray-400 hover:text-white">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="flex-1 flex flex-col">
            <!-- Header -->
            <header class="bg-white shadow-sm border-b p-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <button id="sidebarToggle" class="md:hidden mr-4 text-gray-600">
                            <i class="fas fa-bars text-xl"></i>
                        </button>
                        <h2 id="pageTitle" class="text-xl font-semibold text-gray-800">Dashboard</h2>
                        <!-- Language Selector -->
                        <div class="ml-4 relative">
                            <select id="languageSelector" class="text-sm border rounded px-2 py-1">
                                <option value="en">ðŸ‡ºðŸ‡¸ English</option>
                                <option value="es">ðŸ‡ªðŸ‡¸ EspaÃ±ol</option>
                                <option value="fr">ðŸ‡«ðŸ‡· FranÃ§ais</option>
                                <option value="de">ðŸ‡©ðŸ‡ª Deutsch</option>
                                <option value="zh">ðŸ‡¨ðŸ‡³ ä¸­æ–‡</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <!-- Barcode Scanner Button -->
                        <button id="barcodeScannerBtn" class="text-gray-600 hover:text-gray-900">
                            <i class="fas fa-barcode text-xl"></i>
                        </button>
                        
                        <!-- Advanced Reports Button -->
                        <button id="advancedReportsBtn" class="text-gray-600 hover:text-gray-900">
                            <i class="fas fa-chart-line text-xl"></i>
                        </button>
                        
                        <!-- API Integrations Button -->
                        <button id="apiIntegrationsBtn" class="text-gray-600 hover:text-gray-900">
                            <i class="fas fa-plug text-xl"></i>
                        </button>
                        
                        <!-- Role Management Button (Admin only) -->
                        <button id="roleManagementBtn" class="text-gray-600 hover:text-gray-900 hidden">
                            <i class="fas fa-user-shield text-xl"></i>
                        </button>
                        
                        <div class="relative" id="notificationContainer">
                            <!-- Notifications will be loaded here -->
                        </div>
                        <div class="relative">
                            <input type="text" id="globalSearch" placeholder="Search..." class="pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Main Content Area -->
            <main class="flex-1 overflow-y-auto p-6" id="mainContent">
                <!-- Loading screen -->
                <div id="loadingScreen" class="flex items-center justify-center h-full">
                    <div class="text-center">
                        <div class="loading mx-auto mb-4"></div>
                        <p class="text-gray-600">Loading application...</p>
                    </div>
                </div>
                
                <!-- Dashboard Tab -->
                <div id="dashboard" class="tab-content">
                    <!-- Dashboard content remains the same -->
                </div>
                
                <!-- Advanced Reports Tab -->
                <div id="advancedReports" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold text-gray-800">Advanced Reporting & Analytics</h1>
                        <p class="text-gray-600">Generate detailed business intelligence reports</p>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        <!-- Report Types -->
                        <div class="card bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Report Types</h3>
                            <div class="space-y-3">
                                <button class="w-full text-left p-3 border rounded-lg hover:bg-gray-50 report-type" data-type="sales-trend">
                                    <i class="fas fa-chart-line text-blue-500 mr-2"></i>
                                    <span>Sales Trend Analysis</span>
                                </button>
                                <button class="w-full text-left p-3 border rounded-lg hover:bg-gray-50 report-type" data-type="inventory-turnover">
                                    <i class="fas fa-boxes text-green-500 mr-2"></i>
                                    <span>Inventory Turnover</span>
                                </button>
                                <button class="w-full text-left p-3 border rounded-lg hover:bg-gray-50 report-type" data-type="customer-lifetime-value">
                                    <i class="fas fa-users text-purple-500 mr-2"></i>
                                    <span>Customer Lifetime Value</span>
                                </button>
                                <button class="w-full text-left p-3 border rounded-lg hover:bg-gray-50 report-type" data-type="financial-statements">
                                    <i class="fas fa-file-invoice-dollar text-yellow-500 mr-2"></i>
                                    <span>Financial Statements</span>
                                </button>
                                <button class="w-full text-left p-3 border rounded-lg hover:bg-gray-50 report-type" data-type="profit-margin">
                                    <i class="fas fa-percentage text-red-500 mr-2"></i>
                                    <span>Profit Margin Analysis</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Report Configuration -->
                        <div class="lg:col-span-2">
                            <div class="card bg-white rounded-xl shadow p-6">
                                <h3 class="text-lg font-semibold mb-4">Report Configuration</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Date Range</label>
                                        <div class="grid grid-cols-2 gap-4">
                                            <input type="date" id="reportStartDate" class="w-full px-4 py-2 border rounded-lg">
                                            <input type="date" id="reportEndDate" class="w-full px-4 py-2 border rounded-lg">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Export Format</label>
                                        <div class="flex space-x-4">
                                            <label class="flex items-center">
                                                <input type="radio" name="exportFormat" value="pdf" checked class="mr-2">
                                                <span>PDF</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="radio" name="exportFormat" value="excel" class="mr-2">
                                                <span>Excel</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="radio" name="exportFormat" value="csv" class="mr-2">
                                                <span>CSV</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="radio" name="exportFormat" value="json" class="mr-2">
                                                <span>JSON</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Include Charts</label>
                                        <input type="checkbox" id="includeCharts" checked class="mr-2">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Data Granularity</label>
                                        <select id="dataGranularity" class="w-full px-4 py-2 border rounded-lg">
                                            <option value="daily">Daily</option>
                                            <option value="weekly">Weekly</option>
                                            <option value="monthly">Monthly</option>
                                            <option value="quarterly">Quarterly</option>
                                            <option value="yearly">Yearly</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mt-6">
                                    <button id="generateAdvancedReport" class="btn-primary w-full py-3">
                                        <i class="fas fa-download mr-2"></i> Generate & Export Report
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Report Preview -->
                    <div class="card bg-white rounded-xl shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">Report Preview</h3>
                        <div id="reportPreview" class="border rounded-lg p-4 min-h-[400px]">
                            <p class="text-gray-500 text-center py-20">Select a report type and configure settings to generate preview</p>
                        </div>
                    </div>
                </div>
                
                <!-- Barcode Scanning Tab -->
                <div id="barcodeScanning" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold text-gray-800">Barcode Scanning</h1>
                        <p class="text-gray-600">Scan product barcodes for quick inventory management</p>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Scanner -->
                        <div class="card bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Barcode Scanner</h3>
                            <div id="barcode-scanner" class="mb-4">
                                <div class="scanner-overlay">
                                    <div class="scanner-line"></div>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div class="flex space-x-4">
                                    <button id="startScanner" class="btn-primary flex-1">
                                        <i class="fas fa-play mr-2"></i> Start Scanner
                                    </button>
                                    <button id="stopScanner" class="bg-gray-600 text-white flex-1 py-2 rounded-lg">
                                        <i class="fas fa-stop mr-2"></i> Stop Scanner
                                    </button>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Scanner Type</label>
                                    <select id="scannerType" class="w-full px-4 py-2 border rounded-lg">
                                        <option value="ean_13">EAN-13</option>
                                        <option value="ean_8">EAN-8</option>
                                        <option value="upc_a">UPC-A</option>
                                        <option value="upc_e">UPC-E</option>
                                        <option value="code_128">Code 128</option>
                                        <option value="code_39">Code 39</option>
                                        <option value="qrcode">QR Code</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Scan Results -->
                        <div class="card bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Scan Results</h3>
                            <div class="mb-4">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm text-gray-600">Last Scan:</span>
                                    <span id="lastScanTime" class="text-sm text-gray-500">--:--:--</span>
                                </div>
                                <input type="text" id="scannedBarcode" readonly class="w-full px-4 py-3 border rounded-lg text-center text-xl font-mono bg-gray-50">
                            </div>
                            
                            <div id="productMatch" class="mb-6">
                                <!-- Product match will appear here -->
                            </div>
                            
                            <div class="space-y-3">
                                <button id="addScannedProduct" class="btn-primary w-full py-3">
                                    <i class="fas fa-plus mr-2"></i> Add to Inventory
                                </button>
                                <button id="searchScannedProduct" class="w-full py-3 border border-indigo-600 text-indigo-600 rounded-lg hover:bg-indigo-50">
                                    <i class="fas fa-search mr-2"></i> Search Product
                                </button>
                                <button id="updateStock" class="w-full py-3 border border-green-600 text-green-600 rounded-lg hover:bg-green-50">
                                    <i class="fas fa-edit mr-2"></i> Update Stock
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Scans -->
                    <div class="mt-8 card bg-white rounded-xl shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">Recent Scans</h3>
                        <div class="overflow-x-auto">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>Barcode</th>
                                        <th>Product</th>
                                        <th>Action</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="recentScansTable">
                                    <!-- Recent scans will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- API Integrations Tab -->
                <div id="apiIntegrations" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold text-gray-800">API Integrations</h1>
                        <p class="text-gray-600">Connect with external services and platforms</p>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Available Integrations -->
                        <div class="card bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Available Integrations</h3>
                            <div class="space-y-4">
                                <!-- QuickBooks Integration -->
                                <div class="border rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center">
                                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/cc/QuickBooks_logo.svg/320px-QuickBooks_logo.svg.png" class="h-8 mr-3">
                                            <div>
                                                <h4 class="font-medium">QuickBooks Online</h4>
                                                <p class="text-sm text-gray-600">Accounting Software</p>
                                            </div>
                                        </div>
                                        <span class="api-status api-disconnected"></span>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-3">Sync invoices, payments, and financial data with QuickBooks</p>
                                    <button class="w-full py-2 border border-gray-300 rounded-lg hover:bg-gray-50 connect-api" data-api="quickbooks">
                                        Connect to QuickBooks
                                    </button>
                                </div>
                                
                                <!-- Shopify Integration -->
                                <div class="border rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center">
                                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0e/Shopify_logo_2018.svg/320px-Shopify_logo_2018.svg.png" class="h-8 mr-3">
                                            <div>
                                                <h4 class="font-medium">Shopify</h4>
                                                <p class="text-sm text-gray-600">E-commerce Platform</p>
                                            </div>
                                        </div>
                                        <span class="api-status api-disconnected"></span>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-3">Sync products, orders, and inventory with Shopify store</p>
                                    <button class="w-full py-2 border border-gray-300 rounded-lg hover:bg-gray-50 connect-api" data-api="shopify">
                                        Connect to Shopify
                                    </button>
                                </div>
                                
                                <!-- Xero Integration -->
                                <div class="border rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center">
                                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8e/Xero_software_logo.svg/320px-Xero_software_logo.svg.png" class="h-8 mr-3">
                                            <div>
                                                <h4 class="font-medium">Xero</h4>
                                                <p class="text-sm text-gray-600">Accounting Platform</p>
                                            </div>
                                        </div>
                                        <span class="api-status api-disconnected"></span>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-3">Sync invoices, bills, and bank transactions</p>
                                    <button class="w-full py-2 border border-gray-300 rounded-lg hover:bg-gray-50 connect-api" data-api="xero">
                                        Connect to Xero
                                    </button>
                                </div>
                                
                                <!-- WooCommerce Integration -->
                                <div class="border rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center">
                                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/WooCommerce_logo.svg/320px-WooCommerce_logo.svg.png" class="h-8 mr-3">
                                            <div>
                                                <h4 class="font-medium">WooCommerce</h4>
                                                <p class="text-sm text-gray-600">E-commerce Plugin</p>
                                            </div>
                                        </div>
                                        <span class="api-status api-disconnected"></span>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-3">Sync products and orders with WooCommerce store</p>
                                    <button class="w-full py-2 border border-gray-300 rounded-lg hover:bg-gray-50 connect-api" data-api="woocommerce">
                                        Connect to WooCommerce
                                    </button>
                                </div>
                                
                                <!-- Custom API -->
                                <div class="border rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center">
                                            <i class="fas fa-code text-2xl text-gray-600 mr-3"></i>
                                            <div>
                                                <h4 class="font-medium">Custom API</h4>
                                                <p class="text-sm text-gray-600">Custom Integration</p>
                                            </div>
                                        </div>
                                        <span class="api-status api-disconnected"></span>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-3">Connect to your custom API or webhook</p>
                                    <button class="w-full py-2 border border-gray-300 rounded-lg hover:bg-gray-50" id="setupCustomApi">
                                        Setup Custom API
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Integration Settings -->
                        <div class="card bg-white rounded-xl shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Integration Settings</h3>
                            <div id="integrationSettings">
                                <p class="text-gray-500 text-center py-20">Select an integration to configure settings</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sync Logs -->
                    <div class="mt-8 card bg-white rounded-xl shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">Sync Logs</h3>
                        <div class="overflow-x-auto">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Timestamp</th>
                                        <th>Service</th>
                                        <th>Action</th>
                                        <th>Status</th>
                                        <th>Details</th>
                                    </tr>
                                </thead>
                                <tbody id="syncLogsTable">
                                    <!-- Sync logs will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Role Management Tab -->
                <div id="roleManagement" class="tab-content">
                    <div class="mb-6 flex justify-between items-center">
                        <div>
                            <h1 class="text-2xl font-bold text-gray-800">Role-Based Access Control</h1>
                            <p class="text-gray-600">Manage user roles and permissions</p>
                        </div>
                        <button id="addUserBtn" class="btn-primary flex items-center">
                            <i class="fas fa-user-plus mr-2"></i> Add User
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <!-- User List -->
                        <div class="lg:col-span-2">
                            <div class="card bg-white rounded-xl shadow p-6">
                                <div class="flex justify-between items-center mb-6">
                                    <h3 class="text-lg font-semibold">Users & Permissions</h3>
                                    <div class="flex items-center space-x-2">
                                        <input type="text" placeholder="Search users..." class="px-4 py-2 border rounded-lg">
                                        <button class="px-4 py-2 bg-gray-100 rounded-lg hover:bg-gray-200">
                                            <i class="fas fa-filter"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>User</th>
                                                <th>Email</th>
                                                <th>Role</th>
                                                <th>Status</th>
                                                <th>Last Active</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="usersTable">
                                            <!-- Users will be loaded here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Role Configuration -->
                        <div>
                            <div class="card bg-white rounded-xl shadow p-6">
                                <h3 class="text-lg font-semibold mb-4">Role Configuration</h3>
                                <div class="space-y-6">
                                    <div>
                                        <h4 class="font-medium mb-3">Available Roles</h4>
                                        <div class="space-y-3">
                                            <div class="border rounded-lg p-3">
                                                <div class="flex items-center justify-between mb-2">
                                                    <span class="role-badge role-admin">Admin</span>
                                                    <span class="text-xs text-gray-500">Full access</span>
                                                </div>
                                                <p class="text-sm text-gray-600">Can manage everything including users and settings</p>
                                            </div>
                                            <div class="border rounded-lg p-3">
                                                <div class="flex items-center justify-between mb-2">
                                                    <span class="role-badge role-manager">Manager</span>
                                                    <span class="text-xs text-gray-500">Most access</span>
                                                </div>
                                                <p class="text-sm text-gray-600">Can manage products, sales, and reports</p>
                                            </div>
                                            <div class="border rounded-lg p-3">
                                                <div class="flex items-center justify-between mb-2">
                                                    <span class="role-badge role-staff">Staff</span>
                                                    <span class="text-xs text-gray-500">Limited access</span>
                                                </div>
                                                <p class="text-sm text-gray-600">Can process sales and view products</p>
                                            </div>
                                            <div class="border rounded-lg p-3">
                                                <div class="flex items-center justify-between mb-2">
                                                    <span class="px-2 py-1 bg-gray-100 rounded text-sm">Viewer</span>
                                                    <span class="text-xs text-gray-500">Read-only</span>
                                                </div>
                                                <p class="text-sm text-gray-600">Can view reports and dashboard only</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <h4 class="font-medium mb-3">Permission Settings</h4>
                                        <div class="space-y-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="mr-2 permission-toggle" data-permission="view_dashboard">
                                                <span class="text-sm">View Dashboard</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" class="mr-2 permission-toggle" data-permission="manage_products">
                                                <span class="text-sm">Manage Products</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" class="mr-2 permission-toggle" data-permission="process_sales">
                                                <span class="text-sm">Process Sales</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" class="mr-2 permission-toggle" data-permission="view_reports">
                                                <span class="text-sm">View Reports</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" class="mr-2 permission-toggle" data-permission="manage_users">
                                                <span class="text-sm">Manage Users</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" class="mr-2 permission-toggle" data-permission="manage_settings">
                                                <span class="text-sm">Manage Settings</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Audit Log -->
                    <div class="mt-8 card bg-white rounded-xl shadow p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-semibold">Audit Log</h3>
                            <button id="exportAuditLog" class="text-sm text-indigo-600 hover:text-indigo-800">
                                <i class="fas fa-download mr-1"></i> Export Log
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Timestamp</th>
                                        <th>User</th>
                                        <th>Action</th>
                                        <th>Resource</th>
                                        <th>IP Address</th>
                                    </tr>
                                </thead>
                                <tbody id="auditLogTable">
                                    <!-- Audit logs will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Multi-language Tab -->
                <div id="multiLanguage" class="tab-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold text-gray-800">Multi-language Support</h1>
                        <p class="text-gray-600">Manage translations and language settings</p>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <!-- Language Selection -->
                        <div>
                            <div class="card bg-white rounded-xl shadow p-6">
                                <h3 class="text-lg font-semibold mb-4">Available Languages</h3>
                                <div class="space-y-3">
                                    <button class="w-full text-left p-3 border rounded-lg hover:bg-gray-50 language-selector active" data-lang="en">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center">
                                                <span class="mr-3">ðŸ‡ºðŸ‡¸</span>
                                                <span>English</span>
                                            </div>
                                            <span class="text-xs px-2 py-1 bg-green-100 text-green-800 rounded">Active</span>
                                        </div>
                                    </button>
                                    <button class="w-full text-left p-3 border rounded-lg hover:bg-gray-50 language-selector" data-lang="es">
                                        <div class="flex items-center">
                                            <span class="mr-3">ðŸ‡ªðŸ‡¸</span>
                                            <span>EspaÃ±ol (Spanish)</span>
                                        </div>
                                    </button>
                                    <button class="w-full text-left p-3 border rounded-lg hover:bg-gray-50 language-selector" data-lang="fr">
                                        <div class="flex items-center">
                                            <span class="mr-3">ðŸ‡«ðŸ‡·</span>
                                            <span>FranÃ§ais (French)</span>
                                        </div>
                                    </button>
                                    <button class="w-full text-left p-3 border rounded-lg hover:bg-gray-50 language-selector" data-lang="de">
                                        <div class="flex items-center">
                                            <span class="mr-3">ðŸ‡©ðŸ‡ª</span>
                                            <span>Deutsch (German)</span>
                                        </div>
                                    </button>
                                    <button class="w-full text-left p-3 border rounded-lg hover:bg-gray-50 language-selector" data-lang="zh">
                                        <div class="flex items-center">
                                            <span class="mr-3">ðŸ‡¨ðŸ‡³</span>
                                            <span>ä¸­æ–‡ (Chinese)</span>
                                        </div>
                                    </button>
                                    <button class="w-full text-left p-3 border rounded-lg hover:bg-gray-50 language-selector" data-lang="ar">
                                        <div class="flex items-center">
                                            <span class="mr-3">ðŸ‡¸ðŸ‡¦</span>
                                            <span>Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Arabic)</span>
                                        </div>
                                    </button>
                                </div>
                                <div class="mt-6">
                                    <button id="addLanguageBtn" class="w-full py-2 border border-dashed border-gray-300 rounded-lg hover:bg-gray-50">
                                        <i class="fas fa-plus mr-2"></i> Add New Language
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Translation Editor -->
                        <div class="lg:col-span-2">
                            <div class="card bg-white rounded-xl shadow p-6">
                                <div class="flex justify-between items-center mb-6">
                                    <h3 class="text-lg font-semibold">Translation Editor</h3>
                                    <div class="flex items-center space-x-2">
                                        <span class="text-sm text-gray-600" id="currentLanguage">English</span>
                                        <button id="saveTranslations" class="btn-primary text-sm px-4 py-2">
                                            <i class="fas fa-save mr-1"></i> Save
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <input type="text" placeholder="Search translations..." class="w-full px-4 py-2 border rounded-lg" id="translationSearch">
                                </div>
                                
                                <div class="border rounded-lg overflow-hidden">
                                    <div class="bg-gray-50 p-3 border-b">
                                        <div class="grid grid-cols-2 font-medium text-sm">
                                            <div>Key</div>
                                            <div>Translation</div>
                                        </div>
                                    </div>
                                    <div class="max-h-[400px] overflow-y-auto">
                                        <div class="divide-y">
                                            <!-- Translations will be loaded here -->
                                            <div class="grid grid-cols-2 p-3 hover:bg-gray-50">
                                                <div class="text-sm text-gray-600">dashboard.title</div>
                                                <input type="text" value="Dashboard" class="px-2 py-1 border rounded translation-input" data-key="dashboard.title">
                                            </div>
                                            <div class="grid grid-cols-2 p-3 hover:bg-gray-50">
                                                <div class="text-sm text-gray-600">products.title</div>
                                                <input type="text" value="Products" class="px-2 py-1 border rounded translation-input" data-key="products.title">
                                            </div>
                                            <div class="grid grid-cols-2 p-3 hover:bg-gray-50">
                                                <div class="text-sm text-gray-600">sales.title</div>
                                                <input type="text" value="Sales" class="px-2 py-1 border rounded translation-input" data-key="sales.title">
                                            </div>
                                            <!-- More translations will be dynamically loaded -->
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-4 text-right">
                                    <button id="exportTranslations" class="text-sm text-indigo-600 hover:text-indigo-800 mr-4">
                                        <i class="fas fa-download mr-1"></i> Export
                                    </button>
                                    <button id="importTranslations" class="text-sm text-indigo-600 hover:text-indigo-800">
                                        <i class="fas fa-upload mr-1"></i> Import
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Translation Statistics -->
                    <div class="mt-8 card bg-white rounded-xl shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">Translation Statistics</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <p class="text-sm text-blue-600">Total Languages</p>
                                <p class="text-2xl font-bold" id="totalLanguages">6</p>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <p class="text-sm text-green-600">Translated Keys</p>
                                <p class="text-2xl font-bold" id="translatedKeys">245</p>
                            </div>
                            <div class="bg-yellow-50 p-4 rounded-lg">
                                <p class="text-sm text-yellow-600">Pending Translations</p>
                                <p class="text-2xl font-bold" id="pendingTranslations">12</p>
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <p class="text-sm text-purple-600">Completion Rate</p>
                                <p class="text-2xl font-bold" id="completionRate">95%</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Existing tabs (Products, Sales, etc.) -->
                <div id="products" class="tab-content">
                    <!-- Products content remains the same -->
                </div>
                
                <div id="sales" class="tab-content">
                    <!-- Sales content remains the same -->
                </div>
                <!-- Add other existing tabs as needed -->
                
            </main>
        </div>
    </div>
    
    <!-- Existing Modals (Product, Receipt, Login) -->
    <!-- ... (Previous modal code remains the same) ... -->
    
    <!-- New Modals for Future Features -->
    
    <!-- Barcode Scanner Modal -->
    <div id="barcodeScannerModal" class="modal">
        <div class="modal-content w-full max-w-4xl">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">Barcode Scanner</h3>
                    <button id="closeBarcodeScanner" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div id="fullBarcodeScanner" class="mb-6" style="height: 400px;"></div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Scanner Type</label>
                        <select id="modalScannerType" class="w-full px-4 py-2 border rounded-lg">
                            <option value="ean_13">EAN-13</option>
                            <option value="ean_8">EAN-8</option>
                            <option value="upc_a">UPC-A</option>
                            <option value="upc_e">UPC-E</option>
                            <option value="code_128">Code 128</option>
                            <option value="code_39">Code 39</option>
                            <option value="qrcode">QR Code</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Auto-focus</label>
                        <select id="scannerAutofocus" class="w-full px-4 py-2 border rounded-lg">
                            <option value="true">Enabled</option>
                            <option value="false">Disabled</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Beep on Scan</label>
                        <select id="scannerBeep" class="w-full px-4 py-2 border rounded-lg">
                            <option value="true">Enabled</option>
                            <option value="false">Disabled</option>
                        </select>
                    </div>
                </div>
                <div class="flex space-x-4 mt-6">
                    <button id="modalStartScanner" class="btn-primary flex-1 py-3">
                        <i class="fas fa-play mr-2"></i> Start Scanner
                    </button>
                    <button id="modalStopScanner" class="bg-gray-600 text-white flex-1 py-3 rounded-lg">
                        <i class="fas fa-stop mr-2"></i> Stop Scanner
                    </button>
                    <button id="useCamera" class="border border-indigo-600 text-indigo-600 flex-1 py-3 rounded-lg hover:bg-indigo-50">
                        <i class="fas fa-camera mr-2"></i> Use Camera
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Custom API Setup Modal -->
    <div id="customApiModal" class="modal">
        <div class="modal-content w-full max-w-2xl">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">Custom API Setup</h3>
                    <button id="closeCustomApiModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <form id="customApiForm">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">API Name</label>
                            <input type="text" required class="w-full px-4 py-2 border rounded-lg" placeholder="My Custom API">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Base URL</label>
                            <input type="url" required class="w-full px-4 py-2 border rounded-lg" placeholder="https://api.example.com">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">API Key</label>
                            <input type="password" class="w-full px-4 py-2 border rounded-lg" placeholder="Your API key">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Authentication Type</label>
                            <select class="w-full px-4 py-2 border rounded-lg">
                                <option value="api_key">API Key</option>
                                <option value="bearer_token">Bearer Token</option>
                                <option value="basic_auth">Basic Auth</option>
                                <option value="oauth2">OAuth 2.0</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Sync Frequency</label>
                            <select class="w-full px-4 py-2 border rounded-lg">
                                <option value="realtime">Real-time</option>
                                <option value="hourly">Hourly</option>
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="manual">Manual Only</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Data to Sync</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2" checked>
                                    <span class="text-sm">Products</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2" checked>
                                    <span class="text-sm">Sales</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2">
                                    <span class="text-sm">Customers</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2">
                                    <span class="text-sm">Inventory</span>
                                </label>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Webhook URL (Optional)</label>
                            <input type="url" class="w-full px-4 py-2 border rounded-lg" placeholder="https://your-domain.com/webhook">
                            <p class="text-xs text-gray-500 mt-1">For receiving real-time updates from external systems</p>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-4 mt-8">
                        <button type="button" id="cancelCustomApi" class="px-6 py-2 border rounded-lg hover:bg-gray-50">Cancel</button>
                        <button type="submit" class="btn-primary px-6 py-2">Save API Configuration</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content w-full max-w-2xl">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">Add New User</h3>
                    <button id="closeAddUserModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <form id="addUserForm">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Full Name *</label>
                            <input type="text" required class="w-full px-4 py-2 border rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                            <input type="email" required class="w-full px-4 py-2 border rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Role *</label>
                            <select required class="w-full px-4 py-2 border rounded-lg">
                                <option value="">Select Role</option>
                                <option value="admin">Administrator</option>
                                <option value="manager">Manager</option>
                                <option value="staff">Staff</option>
                                <option value="viewer">Viewer</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Department</label>
                            <input type="text" class="w-full px-4 py-2 border rounded-lg" placeholder="Sales, Inventory, etc.">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Permissions</label>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2" checked>
                                    <span class="text-sm">View Dashboard</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2" checked>
                                    <span class="text-sm">Manage Products</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2" checked>
                                    <span class="text-sm">Process Sales</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2">
                                    <span class="text-sm">View Reports</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2">
                                    <span class="text-sm">Manage Users</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2">
                                    <span class="text-sm">Manage Settings</span>
                                </label>
                            </div>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Send Invitation Email</label>
                            <div class="flex items-center">
                                <input type="checkbox" id="sendInvitation" class="mr-2" checked>
                                <label for="sendInvitation" class="text-sm">Send email invitation with login instructions</label>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-4 mt-8">
                        <button type="button" id="cancelAddUser" class="px-6 py-2 border rounded-lg hover:bg-gray-50">Cancel</button>
                        <button type="submit" class="btn-primary px-6 py-2">Add User</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 bg-gray-800 text-white p-4 rounded-lg shadow-lg hidden z-50 max-w-md">
        <div class="flex items-center">
            <i class="fas fa-check-circle text-green-400 mr-3" id="toastIcon"></i>
            <span id="toastMessage">Action completed successfully!</span>
        </div>
    </div>
    
    <!-- Application JavaScript with Future Features -->
    <script>
        // Internationalization (i18n) setup
        const i18n = i18next.createInstance();
        
        i18n.use(i18nextBrowserLanguageDetector).init({
            fallbackLng: 'en',
            resources: {
                en: {
                    translation: {
                        // Basic translations
                        'dashboard.title': 'Dashboard',
                        'products.title': 'Products',
                        'sales.title': 'Sales',
                        'purchases.title': 'Purchases',
                        'finance.title': 'Finance',
                        'reports.title': 'Reports',
                        'customers.title': 'Customers',
                        'advanced_reports.title': 'Advanced Reports',
                        'barcode_scanning.title': 'Barcode Scanning',
                        'api_integrations.title': 'API Integrations',
                        'role_management.title': 'Role Management',
                        'multi_language.title': 'Multi-language',
                        
                        // Common phrases
                        'welcome': 'Welcome',
                        'loading': 'Loading...',
                        'save': 'Save',
                        'cancel': 'Cancel',
                        'delete': 'Delete',
                        'edit': 'Edit',
                        'add': 'Add',
                        'search': 'Search',
                        
                        // Dashboard
                        'dashboard.overview': 'Dashboard Overview',
                        'dashboard.welcome': 'Welcome back! Here\'s your business summary.',
                        'dashboard.total_revenue': 'Total Revenue',
                        'dashboard.todays_sales': 'Today\'s Sales',
                        'dashboard.total_products': 'Total Products',
                        'dashboard.low_stock': 'Low Stock',
                        
                        // Product management
                        'products.management': 'Product Management',
                        'products.description': 'Manage your inventory, add new products, and track stock levels',
                        'products.add_product': 'Add Product',
                        'products.name': 'Product Name',
                        'products.price': 'Price',
                        'products.stock': 'Stock',
                        'products.category': 'Category',
                        'products.status': 'Status',
                        'products.actions': 'Actions',
                        
                        // Sales
                        'sales.management': 'Sales & Transactions',
                        'sales.description': 'Process sales, create invoices, and manage transactions',
                        'sales.new_sale': 'New Sale',
                        'sales.customer': 'Customer',
                        'sales.payment_method': 'Payment Method',
                        'sales.tax_rate': 'Tax Rate',
                        'sales.discount': 'Discount',
                        'sales.total': 'Total',
                        
                        // Future features
                        'advanced_reports.description': 'Generate detailed business intelligence reports',
                        'barcode_scanning.description': 'Scan product barcodes for quick inventory management',
                        'api_integrations.description': 'Connect with external services and platforms',
                        'role_management.description': 'Manage user roles and permissions',
                        'multi_language.description': 'Manage translations and language settings'
                    }
                },
                es: {
                    translation: {
                        'dashboard.title': 'Panel de Control',
                        'products.title': 'Productos',
                        'sales.title': 'Ventas',
                        'purchases.title': 'Compras',
                        'finance.title': 'Finanzas',
                        'reports.title': 'Informes',
                        'customers.title': 'Clientes',
                        'advanced_reports.title': 'Informes Avanzados',
                        'barcode_scanning.title': 'Escaneo de CÃ³digos de Barras',
                        'api_integrations.title': 'Integraciones API',
                        'role_management.title': 'GestiÃ³n de Roles',
                        'multi_language.title': 'Multilenguaje',
                        
                        'welcome': 'Bienvenido',
                        'loading': 'Cargando...',
                        'save': 'Guardar',
                        'cancel': 'Cancelar',
                        'delete': 'Eliminar',
                        'edit': 'Editar',
                        'add': 'Agregar',
                        'search': 'Buscar',
                        
                        'dashboard.overview': 'Resumen del Panel',
                        'dashboard.welcome': 'Â¡Bienvenido de nuevo! AquÃ­ estÃ¡ el resumen de su negocio.',
                        'dashboard.total_revenue': 'Ingresos Totales',
                        'dashboard.todays_sales': 'Ventas de Hoy',
                        'dashboard.total_products': 'Productos Totales',
                        'dashboard.low_stock': 'Stock Bajo'
                    }
                },
                fr: {
                    translation: {
                        'dashboard.title': 'Tableau de Bord',
                        'products.title': 'Produits',
                        'sales.title': 'Ventes',
                        'purchases.title': 'Achats',
                        'finance.title': 'Finance',
                        'reports.title': 'Rapports',
                        'customers.title': 'Clients',
                        'advanced_reports.title': 'Rapports AvancÃ©s',
                        'barcode_scanning.title': 'Scan de Codes-barres',
                        'api_integrations.title': 'IntÃ©grations API',
                        'role_management.title': 'Gestion des RÃ´les',
                        'multi_language.title': 'Multilingue',
                        
                        'welcome': 'Bienvenue',
                        'loading': 'Chargement...',
                        'save': 'Enregistrer',
                        'cancel': 'Annuler',
                        'delete': 'Supprimer',
                        'edit': 'Modifier',
                        'add': 'Ajouter',
                        'search': 'Rechercher',
                        
                        'dashboard.overview': 'AperÃ§u du Tableau de Bord',
                        'dashboard.welcome': 'Bon retour ! Voici le rÃ©sumÃ© de votre entreprise.',
                        'dashboard.total_revenue': 'Revenu Total',
                        'dashboard.todays_sales': 'Ventes d\'Aujourd\'hui',
                        'dashboard.total_products': 'Produits Totaux',
                        'dashboard.low_stock': 'Stock Faible'
                    }
                }
            }
        });
        
        // DOM Elements (extended)
        const elements = {
            // Existing elements...
            
            // Future feature elements
            barcodeScannerBtn: document.getElementById('barcodeScannerBtn'),
            advancedReportsBtn: document.getElementById('advancedReportsBtn'),
            apiIntegrationsBtn: document.getElementById('apiIntegrationsBtn'),
            roleManagementBtn: document.getElementById('roleManagementBtn'),
            languageSelector: document.getElementById('languageSelector'),
            pwaInstallButton: document.getElementById('pwaInstallButton'),
            
            // New tabs
            advancedReports: document.getElementById('advancedReports'),
            barcodeScanning: document.getElementById('barcodeScanning'),
            apiIntegrations: document.getElementById('apiIntegrations'),
            roleManagement: document.getElementById('roleManagement'),
            multiLanguage: document.getElementById('multiLanguage'),
            
            // New modals
            barcodeScannerModal: document.getElementById('barcodeScannerModal'),
            customApiModal: document.getElementById('customApiModal'),
            addUserModal: document.getElementById('addUserModal')
        };
        
        // Firebase collections (extended)
        const collections = {
            // Existing collections...
            users: 'users',
            products: 'products',
            sales: 'sales',
            customers: 'customers',
            suppliers: 'suppliers',
            purchases: 'purchases',
            categories: 'categories',
            transactions: 'transactions',
            settings: 'settings',
            
            // New collections for future features
            barcodeScans: 'barcodeScans',
            apiIntegrations: 'apiIntegrations',
            userRoles: 'userRoles',
            auditLogs: 'auditLogs',
            translations: 'translations',
            reports: 'reports',
            syncLogs: 'syncLogs'
        };
        
        // Barcode scanner instance
        let barcodeScanner = null;
        let isScannerActive = false;
        
        // Initialize the application with future features
        async function initApp() {
            try {
                // Check authentication state
                auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        // User is signed in
                        appState.currentUser = user;
                        await loadUserData(user.uid);
                        elements.loginModal.classList.remove('active');
                        elements.loadingScreen.style.display = 'none';
                        updateUserUI(user);
                        await initializeData();
                        setupEventListeners();
                        
                        // Initialize future features
                        await initializeFutureFeatures();
                    } else {
                        // No user is signed in
                        elements.loginModal.classList.add('active');
                        elements.loadingScreen.style.display = 'none';
                    }
                });
                
                // Initialize i18n
                await i18n.changeLanguage(appState.language);
                
                // Update UI with current language
                updateLanguageUI();
                
                // Set up PWA installation
                setupPWAInstall();
                
                // Update system status
                elements.systemStatus.textContent = 'Connected';
                showToast('System connected successfully!', 'success');
                
            } catch (error) {
                console.error('Error initializing app:', error);
                elements.systemStatus.textContent = 'Connection Failed';
                showToast('Failed to connect to system. Please refresh.', 'error');
            }
        }
        
        // Initialize future features
        async function initializeFutureFeatures() {
            try {
                // Load API connection status
                await loadApiConnections();
                
                // Update role-based UI
                updateRoleBasedUI();
                
                // Load recent barcode scans
                await loadRecentScans();
                
                // Load API sync logs
                await loadSyncLogs();
                
                // Load user list for role management
                await loadUsers();
                
                // Load audit logs
                await loadAuditLogs();
                
                // Setup barcode scanner
                setupBarcodeScanner();
                
                // Setup advanced reports
                setupAdvancedReports();
                
                // Setup API integrations
                setupApiIntegrations();
                
                // Setup role management
                setupRoleManagement();
                
                // Setup multi-language
                setupMultiLanguage();
                
            } catch (error) {
                console.error('Error initializing future features:', error);
            }
        }
        
        // Setup PWA installation
        function setupPWAInstall() {
            // Check if PWA is already installed
            if (window.matchMedia('(display-mode: standalone)').matches) {
                appState.isPWAInstalled = true;
                elements.pwaInstallButton.style.display = 'none';
            }
            
            // Listen for beforeinstallprompt event
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                appState.deferredPrompt = e;
                elements.pwaInstallButton.style.display = 'block';
            });
            
            // Listen for app installed event
            window.addEventListener('appinstalled', () => {
                appState.isPWAInstalled = true;
                elements.pwaInstallButton.style.display = 'none';
                showToast('App installed successfully!', 'success');
            });
            
            // Install button click handler
            elements.pwaInstallButton.addEventListener('click', async () => {
                if (appState.deferredPrompt) {
                    appState.deferredPrompt.prompt();
                    const { outcome } = await appState.deferredPrompt.userChoice;
                    if (outcome === 'accepted') {
                        appState.deferredPrompt = null;
                    }
                }
            });
        }
        
        // Update role-based UI
        function updateRoleBasedUI() {
            const role = appState.userRole;
            
            // Show/hide role management button
            if (role === 'admin') {
                elements.roleManagementBtn.classList.remove('hidden');
            } else {
                elements.roleManagementBtn.classList.add('hidden');
            }
            
            // Update sidebar menu based on role
            updateSidebarMenu(role);
        }
        
        // Update sidebar menu based on user role
        function updateSidebarMenu(role) {
            const sidebarMenu = document.getElementById('sidebarMenu');
            const baseMenu = `
                <li>
                    <a href="#" data-tab="dashboard" class="tab-link flex items-center p-3 rounded-lg hover:bg-gray-800 transition-colors active">
                        <i class="fas fa-tachometer-alt mr-3"></i>
                        <span data-i18n="dashboard.title">Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="#" data-tab="products" class="tab-link flex items-center p-3 rounded-lg hover:bg-gray-800 transition-colors">
                        <i class="fas fa-boxes mr-3"></i>
                        <span data-i18n="products.title">Products</span>
                    </a>
                </li>
                <li>
                    <a href="#" data-tab="sales" class="tab-link flex items-center p-3 rounded-lg hover:bg-gray-800 transition-colors">
                        <i class="fas fa-shopping-cart mr-3"></i>
                        <span data-i18n="sales.title">Sales</span>
                    </a>
                </li>
            `;
            
            let advancedMenu = '';
            
            // Add advanced features based on role
            if (role === 'admin' || role === 'manager') {
                advancedMenu += `
                    <li>
                        <a href="#" data-tab="advancedReports" class="tab-link flex items-center p-3 rounded-lg hover:bg-gray-800 transition-colors">
                            <i class="fas fa-chart-line mr-3"></i>
                            <span data-i18n="advanced_reports.title">Advanced Reports</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" data-tab="apiIntegrations" class="tab-link flex items-center p-3 rounded-lg hover:bg-gray-800 transition-colors">
                            <i class="fas fa-plug mr-3"></i>
                            <span data-i18n="api_integrations.title">API Integrations</span>
                        </a>
                    </li>
                `;
            }
            
            if (role === 'admin') {
                advancedMenu += `
                    <li>
                        <a href="#" data-tab="roleManagement" class="tab-link flex items-center p-3 rounded-lg hover:bg-gray-800 transition-colors">
                            <i class="fas fa-user-shield mr-3"></i>
                            <span data-i18n="role_management.title">Role Management</span>
                        </a>
                    </li>
                `;
            }
            
            // Add common features
            advancedMenu += `
                <li>
                    <a href="#" data-tab="barcodeScanning" class="tab-link flex items-center p-3 rounded-lg hover:bg-gray-800 transition-colors">
                        <i class="fas fa-barcode mr-3"></i>
                        <span data-i18n="barcode_scanning.title">Barcode Scanning</span>
                    </a>
                </li>
                <li>
                    <a href="#" data-tab="multiLanguage" class="tab-link flex items-center p-3 rounded-lg hover:bg-gray-800 transition-colors">
                        <i class="fas fa-language mr-3"></i>
                        <span data-i18n="multi_language.title">Multi-language</span>
                    </a>
                </li>
            `;
            
            sidebarMenu.innerHTML = baseMenu + advancedMenu;
            
            // Update translations for new menu items
            updateTranslations();
        }
        
        // Setup barcode scanner
        function setupBarcodeScanner() {
            // Start scanner button
            document.getElementById('startScanner')?.addEventListener('click', startBarcodeScanner);
            document.getElementById('stopScanner')?.addEventListener('click', stopBarcodeScanner);
            document.getElementById('modalStartScanner')?.addEventListener('click', startBarcodeScanner);
            document.getElementById('modalStopScanner')?.addEventListener('click', stopBarcodeScanner);
            
            // Scanner modal
            elements.barcodeScannerBtn.addEventListener('click', () => {
                elements.barcodeScannerModal.classList.add('active');
            });
            
            document.getElementById('closeBarcodeScanner')?.addEventListener('click', () => {
                elements.barcodeScannerModal.classList.remove('active');
                stopBarcodeScanner();
            });
            
            // Barcode scanner type change
            document.getElementById('scannerType')?.addEventListener('change', (e) => {
                if (isScannerActive) {
                    stopBarcodeScanner();
                    setTimeout(() => startBarcodeScanner(e.target.value), 500);
                }
            });
        }
        
        // Start barcode scanner
        function startBarcodeScanner(type = 'ean_13') {
            if (isScannerActive) return;
            
            const scannerElement = elements.barcodeScannerModal.classList.contains('active') 
                ? document.getElementById('fullBarcodeScanner')
                : document.getElementById('barcode-scanner');
            
            Quagga.init({
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: scannerElement,
                    constraints: {
                        facingMode: "environment"
                    }
                },
                decoder: {
                    readers: [type]
                }
            }, function(err) {
                if (err) {
                    console.error(err);
                    showToast('Failed to start scanner: ' + err.message, 'error');
                    return;
                }
                
                Quagga.start();
                isScannerActive = true;
                
                // Update button states
                document.getElementById('startScanner')?.classList.add('hidden');
                document.getElementById('stopScanner')?.classList.remove('hidden');
                document.getElementById('modalStartScanner')?.classList.add('hidden');
                document.getElementById('modalStopScanner')?.classList.remove('hidden');
            });
            
            Quagga.onDetected(async function(result) {
                const code = result.codeResult.code;
                
                // Update scan result display
                document.getElementById('scannedBarcode').value = code;
                document.getElementById('lastScanTime').textContent = new Date().toLocaleTimeString();
                
                // Save scan to database
                await saveBarcodeScan(code);
                
                // Search for product with this barcode
                await searchProductByBarcode(code);
                
                // Play beep sound if enabled
                if (document.getElementById('scannerBeep')?.value === 'true') {
                    playBeepSound();
                }
            });
        }
        
        // Stop barcode scanner
        function stopBarcodeScanner() {
            if (!isScannerActive) return;
            
            Quagga.stop();
            isScannerActive = false;
            
            // Update button states
            document.getElementById('startScanner')?.classList.remove('hidden');
            document.getElementById('stopScanner')?.classList.add('hidden');
            document.getElementById('modalStartScanner')?.classList.remove('hidden');
            document.getElementById('modalStopScanner')?.classList.add('hidden');
        }
        
        // Save barcode scan to database
        async function saveBarcodeScan(barcode) {
            try {
                await db.collection(collections.barcodeScans).add({
                    userId: appState.currentUser.uid,
                    barcode: barcode,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'scanned'
                });
                
                // Update recent scans
                await loadRecentScans();
                
            } catch (error) {
                console.error('Error saving barcode scan:', error);
            }
        }
        
        // Search product by barcode
        async function searchProductByBarcode(barcode) {
            try {
                const snapshot = await db.collection(collections.products)
                    .where('userId', '==', appState.currentUser.uid)
                    .where('barcode', '==', barcode)
                    .limit(1)
                    .get();
                
                const productMatch = document.getElementById('productMatch');
                
                if (!snapshot.empty) {
                    const product = snapshot.docs[0].data();
                    productMatch.innerHTML = `
                        <div class="border border-green-200 bg-green-50 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="font-medium text-green-800">Product Found</h4>
                                <span class="text-sm text-green-600">Stock: ${product.stock}</span>
                            </div>
                            <p class="text-green-700">${product.name}</p>
                            <p class="text-sm text-green-600">Price: $${product.price?.toFixed(2)}</p>
                            <div class="mt-3 flex space-x-2">
                                <button class="text-sm text-blue-600 hover:text-blue-800" onclick="editProduct('${snapshot.docs[0].id}')">
                                    <i class="fas fa-edit mr-1"></i> Edit
                                </button>
                                <button class="text-sm text-green-600 hover:text-green-800" onclick="updateProductStock('${snapshot.docs[0].id}')">
                                    <i class="fas fa-edit mr-1"></i> Update Stock
                                </button>
                            </div>
                        </div>
                    `;
                } else {
                    productMatch.innerHTML = `
                        <div class="border border-yellow-200 bg-yellow-50 rounded-lg p-4">
                            <h4 class="font-medium text-yellow-800">No Product Found</h4>
                            <p class="text-sm text-yellow-700">No product found with barcode: ${barcode}</p>
                            <button class="mt-3 text-sm text-indigo-600 hover:text-indigo-800" onclick="createProductFromBarcode('${barcode}')">
                                <i class="fas fa-plus mr-1"></i> Create New Product
                            </button>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('Error searching product by barcode:', error);
            }
        }
        
        // Load recent scans
        async function loadRecentScans() {
            try {
                const snapshot = await db.collection(collections.barcodeScans)
                    .where('userId', '==', appState.currentUser.uid)
                    .orderBy('timestamp', 'desc')
                    .limit(10)
                    .get();
                
                const table = document.getElementById('recentScansTable');
                let html = '';
                
                snapshot.forEach(doc => {
                    const scan = doc.data();
                    const time = scan.timestamp?.toDate().toLocaleTimeString() || '--:--:--';
                    
                    html += `
                        <tr>
                            <td>${time}</td>
                            <td class="font-mono">${scan.barcode}</td>
                            <td>${scan.productName || 'Not matched'}</td>
                            <td>${scan.action || 'Scan'}</td>
                            <td>
                                <span class="badge ${scan.status === 'matched' ? 'badge-success' : 'badge-warning'}">
                                    ${scan.status || 'scanned'}
                                </span>
                            </td>
                        </tr>
                    `;
                });
                
                table.innerHTML = html || '<tr><td colspan="5" class="text-center py-4 text-gray-500">No recent scans</td></tr>';
                
            } catch (error) {
                console.error('Error loading recent scans:', error);
            }
        }
        
        // Setup advanced reports
        function setupAdvancedReports() {
            // Report type selection
            document.querySelectorAll('.report-type').forEach(button => {
                button.addEventListener('click', (e) => {
                    const reportType = e.currentTarget.getAttribute('data-type');
                    loadReportPreview(reportType);
                    
                    // Update active state
                    document.querySelectorAll('.report-type').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    e.currentTarget.classList.add('active');
                });
            });
            
            // Generate report button
            document.getElementById('generateAdvancedReport')?.addEventListener('click', generateAdvancedReport);
            
            // Advanced reports button in header
            elements.advancedReportsBtn.addEventListener('click', () => {
                switchTab('advancedReports');
            });
        }
        
        // Load report preview
        async function loadReportPreview(reportType) {
            const preview = document.getElementById('reportPreview');
            preview.innerHTML = `
                <div class="text-center py-8">
                    <div class="loading mx-auto mb-4"></div>
                    <p class="text-gray-600">Generating ${reportType.replace('-', ' ')} preview...</p>
                </div>
            `;
            
            // Simulate API call
            setTimeout(() => {
                let reportContent = '';
                
                switch(reportType) {
                    case 'sales-trend':
                        reportContent = generateSalesTrendReport();
                        break;
                    case 'inventory-turnover':
                        reportContent = generateInventoryTurnoverReport();
                        break;
                    case 'customer-lifetime-value':
                        reportContent = generateCustomerLifetimeValueReport();
                        break;
                    case 'financial-statements':
                        reportContent = generateFinancialStatementsReport();
                        break;
                    case 'profit-margin':
                        reportContent = generateProfitMarginReport();
                        break;
                }
                
                preview.innerHTML = reportContent;
            }, 1000);
        }
        
        // Generate advanced report
        async function generateAdvancedReport() {
            try {
                const reportType = document.querySelector('.report-type.active')?.getAttribute('data-type');
                const startDate = document.getElementById('reportStartDate').value;
                const endDate = document.getElementById('reportEndDate').value;
                const format = document.querySelector('input[name="exportFormat"]:checked').value;
                const includeCharts = document.getElementById('includeCharts').checked;
                const granularity = document.getElementById('dataGranularity').value;
                
                if (!reportType) {
                    showToast('Please select a report type', 'error');
                    return;
                }
                
                // Generate report data
                const reportData = await generateReportData(reportType, {
                    startDate,
                    endDate,
                    granularity
                });
                
                // Export based on format
                switch(format) {
                    case 'pdf':
                        exportReportAsPDF(reportData, reportType);
                        break;
                    case 'excel':
                        exportReportAsExcel(reportData, reportType);
                        break;
                    case 'csv':
                        exportReportAsCSV(reportData, reportType);
                        break;
                    case 'json':
                        exportReportAsJSON(reportData, reportType);
                        break;
                }
                
                showToast('Report generated successfully!', 'success');
                
            } catch (error) {
                console.error('Error generating report:', error);
                showToast('Error generating report', 'error');
            }
        }
        
        // Setup API integrations
        function setupApiIntegrations() {
            // API integration buttons
            document.querySelectorAll('.connect-api').forEach(button => {
                button.addEventListener('click', (e) => {
                    const api = e.currentTarget.getAttribute('data-api');
                    connectToApi(api);
                });
            });
            
            // Custom API setup
            document.getElementById('setupCustomApi')?.addEventListener('click', () => {
                elements.customApiModal.classList.add('active');
            });
            
            // Close custom API modal
            document.getElementById('closeCustomApiModal')?.addEventListener('click', () => {
                elements.customApiModal.classList.remove('active');
            });
            
            document.getElementById('cancelCustomApi')?.addEventListener('click', () => {
                elements.customApiModal.classList.remove('active');
            });
            
            // API integrations button in header
            elements.apiIntegrationsBtn.addEventListener('click', () => {
                switchTab('apiIntegrations');
            });
        }
        
        // Connect to API
        async function connectToApi(apiName) {
            try {
                showToast(`Connecting to ${apiName}...`, 'info');
                
                // For demo purposes, simulate API connection
                setTimeout(() => {
                    // Update API status
                    updateApiStatus(apiName, 'connected');
                    
                    // Save API connection to database
                    saveApiConnection(apiName);
                    
                    showToast(`Successfully connected to ${apiName}!`, 'success');
                    
                    // Load integration settings
                    loadIntegrationSettings(apiName);
                    
                }, 1500);
                
            } catch (error) {
                console.error(`Error connecting to ${apiName}:`, error);
                showToast(`Failed to connect to ${apiName}`, 'error');
            }
        }
        
        // Update API status
        function updateApiStatus(apiName, status) {
            const apiElement = document.querySelector(`[data-api="${apiName}"]`);
            if (apiElement) {
                const statusElement = apiElement.closest('.border').querySelector('.api-status');
                statusElement.className = `api-status api-${status}`;
            }
            
            // Update API connections state
            appState.apiConnections[apiName] = status;
            
            // Update API status display
            updateApiStatusDisplay();
        }
        
        // Load API connections
        async function loadApiConnections() {
            try {
                const snapshot = await db.collection(collections.apiIntegrations)
                    .where('userId', '==', appState.currentUser.uid)
                    .get();
                
                snapshot.forEach(doc => {
                    const integration = doc.data();
                    updateApiStatus(integration.name, integration.status);
                });
                
            } catch (error) {
                console.error('Error loading API connections:', error);
            }
        }
        
        // Save API connection
        async function saveApiConnection(apiName) {
            try {
                await db.collection(collections.apiIntegrations).add({
                    userId: appState.currentUser.uid,
                    name: apiName,
                    status: 'connected',
                    connectedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    lastSync: firebase.firestore.FieldValue.serverTimestamp()
                });
            } catch (error) {
                console.error('Error saving API connection:', error);
            }
        }
        
        // Update API status display
        function updateApiStatusDisplay() {
            const apiStatusElement = document.getElementById('apiStatus');
            let html = '';
            
            Object.entries(appState.apiConnections).forEach(([api, status]) => {
                html += `
                    <div class="flex items-center text-sm">
                        <span class="api-status api-${status} mr-2"></span>
                        <span>${api.charAt(0).toUpperCase() + api.slice(1)}: ${status}</span>
                    </div>
                `;
            });
            
            apiStatusElement.innerHTML = html;
        }
        
        // Load integration settings
        function loadIntegrationSettings(apiName) {
            const settingsElement = document.getElementById('integrationSettings');
            
            let settingsHtml = '';
            
            switch(apiName) {
                case 'quickbooks':
                    settingsHtml = `
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-medium mb-2">QuickBooks Settings</h4>
                                <p class="text-sm text-gray-600 mb-4">Configure how data syncs with QuickBooks Online</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Sync Direction</label>
                                <select class="w-full px-4 py-2 border rounded-lg">
                                    <option value="bidirectional">Bidirectional Sync</option>
                                    <option value="to_quickbooks">ProManage â†’ QuickBooks</option>
                                    <option value="from_quickbooks">QuickBooks â†’ ProManage</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Sync Frequency</label>
                                <select class="w-full px-4 py-2 border rounded-lg">
                                    <option value="realtime">Real-time</option>
                                    <option value="hourly">Hourly</option>
                                    <option value="daily">Daily</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Data to Sync</label>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" class="mr-2" checked>
                                        <span class="text-sm">Invoices</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="mr-2" checked>
                                        <span class="text-sm">Payments</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="mr-2">
                                        <span class="text-sm">Customers</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="mr-2">
                                        <span class="text-sm">Products/Items</span>
                                    </label>
                                </div>
                            </div>
                            <div class="pt-4 border-t">
                                <button class="btn-primary w-full py-2" onclick="testQuickBooksConnection()">
                                    Test Connection
                                </button>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'shopify':
                    settingsHtml = `
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-medium mb-2">Shopify Settings</h4>
                                <p class="text-sm text-gray-600 mb-4">Configure Shopify store integration</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Store URL</label>
                                <input type="url" class="w-full px-4 py-2 border rounded-lg" placeholder="https://your-store.myshopify.com">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">API Version</label>
                                <select class="w-full px-4 py-2 border rounded-lg">
                                    <option value="2023-07">2023-07</option>
                                    <option value="2023-04">2023-04</option>
                                    <option value="2023-01">2023-01</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Sync Options</label>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" class="mr-2" checked>
                                        <span class="text-sm">Sync Products</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="mr-2" checked>
                                        <span class="text-sm">Sync Orders</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="mr-2">
                                        <span class="text-sm">Sync Customers</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="mr-2">
                                        <span class="text-sm">Sync Inventory</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                    
                default:
                    settingsHtml = `
                        <div class="text-center py-8">
                            <i class="fas fa-cog text-4xl text-gray-300 mb-4"></i>
                            <p class="text-gray-500">Configure settings for ${apiName}</p>
                        </div>
                    `;
            }
            
            settingsElement.innerHTML = settingsHtml;
        }
        
        // Load sync logs
        async function loadSyncLogs() {
            try {
                const snapshot = await db.collection(collections.syncLogs)
                    .where('userId', '==', appState.currentUser.uid)
                    .orderBy('timestamp', 'desc')
                    .limit(20)
                    .get();
                
                const table = document.getElementById('syncLogsTable');
                let html = '';
                
                snapshot.forEach(doc => {
                    const log = doc.data();
                    const time = log.timestamp?.toDate().toLocaleString() || '--';
                    const statusBadge = log.status === 'success' ? 'badge-success' : 
                                       log.status === 'error' ? 'badge-danger' : 'badge-warning';
                    
                    html += `
                        <tr>
                            <td class="text-sm">${time}</td>
                            <td>${log.service}</td>
                            <td>${log.action}</td>
                            <td><span class="badge ${statusBadge}">${log.status}</span></td>
                            <td class="text-sm text-gray-600">${log.details || ''}</td>
                        </tr>
                    `;
                });
                
                table.innerHTML = html || '<tr><td colspan="5" class="text-center py-4 text-gray-500">No sync logs</td></tr>';
                
            } catch (error) {
                console.error('Error loading sync logs:', error);
            }
        }
        
        // Setup role management
        function setupRoleManagement() {
            // Add user button
            document.getElementById('addUserBtn')?.addEventListener('click', () => {
                elements.addUserModal.classList.add('active');
            });
            
            // Close add user modal
            document.getElementById('closeAddUserModal')?.addEventListener('click', () => {
                elements.addUserModal.classList.remove('active');
            });
            
            document.getElementById('cancelAddUser')?.addEventListener('click', () => {
                elements.addUserModal.classList.remove('active');
            });
            
            // Role management button in header
            elements.roleManagementBtn.addEventListener('click', () => {
                switchTab('roleManagement');
            });
        }
        
        // Load users for role management
        async function loadUsers() {
            try {
                const snapshot = await db.collection(collections.users)
                    .where('businessId', '==', appState.userData?.businessId || appState.currentUser.uid)
                    .get();
                
                const table = document.getElementById('usersTable');
                let html = '';
                
                snapshot.forEach(doc => {
                    const user = doc.data();
                    const roleBadgeClass = user.role === 'admin' ? 'role-admin' :
                                          user.role === 'manager' ? 'role-manager' :
                                          user.role === 'staff' ? 'role-staff' : '';
                    
                    html += `
                        <tr>
                            <td>
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center mr-3">
                                        <span class="text-sm font-medium">${user.name?.charAt(0) || 'U'}</span>
                                    </div>
                                    <div>
                                        <p class="font-medium">${user.name}</p>
                                        <p class="text-xs text-gray-500">${user.department || 'General'}</p>
                                    </div>
                                </div>
                            </td>
                            <td>${user.email}</td>
                            <td><span class="role-badge ${roleBadgeClass}">${user.role || 'staff'}</span></td>
                            <td>
                                <div class="flex items-center">
                                    <span class="status-indicator ${user.status === 'active' ? 'status-active' : 'status-inactive'}"></span>
                                    <span>${user.status || 'active'}</span>
                                </div>
                            </td>
                            <td class="text-sm text-gray-600">${user.lastActive?.toDate().toLocaleDateString() || 'Never'}</td>
                            <td>
                                <div class="flex space-x-2">
                                    <button class="text-blue-600 hover:text-blue-800 edit-user" data-id="${doc.id}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="text-red-600 hover:text-red-800 delete-user" data-id="${doc.id}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                table.innerHTML = html || '<tr><td colspan="6" class="text-center py-4 text-gray-500">No users found</td></tr>';
                
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }
        
        // Load audit logs
        async function loadAuditLogs() {
            try {
                const snapshot = await db.collection(collections.auditLogs)
                    .where('userId', '==', appState.currentUser.uid)
                    .orderBy('timestamp', 'desc')
                    .limit(50)
                    .get();
                
                const table = document.getElementById('auditLogTable');
                let html = '';
                
                snapshot.forEach(doc => {
                    const log = doc.data();
                    const time = log.timestamp?.toDate().toLocaleString() || '--';
                    
                    html += `
                        <tr>
                            <td class="text-sm">${time}</td>
                            <td>${log.userName || 'System'}</td>
                            <td>${log.action}</td>
                            <td>${log.resource}</td>
                            <td class="text-sm text-gray-600">${log.ipAddress || 'N/A'}</td>
                        </tr>
                    `;
                });
                
                table.innerHTML = html || '<tr><td colspan="5" class="text-center py-4 text-gray-500">No audit logs</td></tr>';
                
            } catch (error) {
                console.error('Error loading audit logs:', error);
            }
        }
        
        // Setup multi-language
        function setupMultiLanguage() {
            // Language selector
            elements.languageSelector.addEventListener('change', (e) => {
                changeLanguage(e.target.value);
            });
            
            // Language buttons
            document.querySelectorAll('.language-selector').forEach(button => {
                button.addEventListener('click', (e) => {
                    const lang = e.currentTarget.getAttribute('data-lang');
                    changeLanguage(lang);
                    
                    // Update active state
                    document.querySelectorAll('.language-selector').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    e.currentTarget.classList.add('active');
                });
            });
            
            // Save translations
            document.getElementById('saveTranslations')?.addEventListener('click', saveTranslations);
            
            // Translation search
            document.getElementById('translationSearch')?.addEventListener('input', debounce(searchTranslations, 300));
        }
        
        // Change language
        async function changeLanguage(lang) {
            try {
                await i18n.changeLanguage(lang);
                appState.language = lang;
                
                // Update UI
                updateLanguageUI();
                
                // Save language preference
                await saveLanguagePreference(lang);
                
                showToast(`Language changed to ${lang}`, 'success');
                
            } catch (error) {
                console.error('Error changing language:', error);
                showToast('Error changing language', 'error');
            }
        }
        
        // Update language UI
        function updateLanguageUI() {
            // Update all elements with data-i18n attribute
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                element.textContent = i18n.t(key);
            });
            
            // Update language selector
            elements.languageSelector.value = appState.language;
            document.getElementById('userLanguage').textContent = appState.language.toUpperCase();
            
            // Update current language display
            const currentLanguage = document.getElementById('currentLanguage');
            if (currentLanguage) {
                currentLanguage.textContent = i18n.t(`languages.${appState.language}`) || appState.language.toUpperCase();
            }
        }
        
        // Save language preference
        async function saveLanguagePreference(lang) {
            try {
                await db.collection(collections.users).doc(appState.currentUser.uid).update({
                    language: lang,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
            } catch (error) {
                console.error('Error saving language preference:', error);
            }
        }
        
        // Save translations
        async function saveTranslations() {
            try {
                const translations = {};
                
                // Collect all translations
                document.querySelectorAll('.translation-input').forEach(input => {
                    const key = input.getAttribute('data-key');
                    const value = input.value;
                    translations[key] = value;
                });
                
                // Save to Firestore
                await db.collection(collections.translations).doc(appState.language).set({
                    language: appState.language,
                    translations: translations,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedBy: appState.currentUser.uid
                }, { merge: true });
                
                showToast('Translations saved successfully!', 'success');
                
            } catch (error) {
                console.error('Error saving translations:', error);
                showToast('Error saving translations', 'error');
            }
        }
        
        // Search translations
        function searchTranslations(e) {
            const searchTerm = e.target.value.toLowerCase();
            
            document.querySelectorAll('.translation-input').forEach(input => {
                const row = input.closest('.grid');
                const key = input.getAttribute('data-key');
                
                if (key.toLowerCase().includes(searchTerm) || input.value.toLowerCase().includes(searchTerm)) {
                    row.style.display = 'grid';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        // Update translations
        function updateTranslations() {
            // This would load translations from Firestore and update the UI
            // For now, we'll just update elements with data-i18n attribute
            updateLanguageUI();
        }
        
        // Helper functions for report generation (demo implementations)
        function generateSalesTrendReport() {
            return `
                <div class="p-4">
                    <h4 class="font-bold text-lg mb-4">Sales Trend Analysis Report</h4>
                    <div class="mb-6">
                        <canvas id="salesTrendChart" height="200"></canvas>
                    </div>
                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <div class="bg-blue-50 p-3 rounded">
                            <p class="text-sm text-blue-600">Total Sales</p>
                            <p class="text-xl font-bold">$45,230</p>
                        </div>
                        <div class="bg-green-50 p-3 rounded">
                            <p class="text-sm text-green-600">Growth Rate</p>
                            <p class="text-xl font-bold">+12.5%</p>
                        </div>
                        <div class="bg-purple-50 p-3 rounded">
                            <p class="text-sm text-purple-600">Avg. Daily Sales</p>
                            <p class="text-xl font-bold">$1,507</p>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600">
                        <p>Report generated on ${new Date().toLocaleDateString()}</p>
                        <p>Data granularity: Monthly</p>
                    </div>
                </div>
            `;
        }
        
        function generateInventoryTurnoverReport() {
            return `
                <div class="p-4">
                    <h4 class="font-bold text-lg mb-4">Inventory Turnover Report</h4>
                    <div class="space-y-4">
                        <div>
                            <p class="text-sm text-gray-600 mb-2">Inventory Turnover Ratio: <span class="font-bold">4.2</span></p>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-green-500 h-2 rounded-full" style="width: 70%"></div>
                            </div>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600 mb-2">Days in Inventory: <span class="font-bold">86.9</span></p>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-yellow-500 h-2 rounded-full" style="width: 50%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6">
                        <h5 class="font-medium mb-2">Top Performing Products</h5>
                        <ul class="space-y-2">
                            <li class="flex justify-between">
                                <span>Wireless Headphones</span>
                                <span class="font-medium">8.5 turns/year</span>
                            </li>
                            <li class="flex justify-between">
                                <span>Smartphone X1</span>
                                <span class="font-medium">6.2 turns/year</span>
                            </li>
                            <li class="flex justify-between">
                                <span>Laptop Pro</span>
                                <span class="font-medium">5.8 turns/year</span>
                            </li>
                        </ul>
                    </div>
                </div>
            `;
        }
        
        // Play beep sound for barcode scanner
        function playBeepSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
        }
        
        // Global helper functions for barcode scanning
        window.editProduct = editProduct;
        window.updateProductStock = async function(productId) {
            const newStock = prompt('Enter new stock quantity:');
            if (newStock !== null) {
                try {
                    await db.collection(collections.products).doc(productId).update({
                        stock: parseInt(newStock),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    showToast('Stock updated successfully!', 'success');
                    await searchProductByBarcode(document.getElementById('scannedBarcode').value);
                } catch (error) {
                    console.error('Error updating stock:', error);
                    showToast('Error updating stock', 'error');
                }
            }
        };
        
        window.createProductFromBarcode = function(barcode) {
            // Redirect to products tab with barcode pre-filled
            switchTab('products');
            
            // Show add product modal with barcode pre-filled
            setTimeout(() => {
                document.getElementById('addProductBtn').click();
                setTimeout(() => {
                    document.getElementById('productSKU').value = barcode;
                    showToast('Barcode pre-filled. Please complete product details.', 'info');
                }, 500);
            }, 500);
        };
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
